<%- include ("partials/header") %>

<% const convertUnits = (ingredients, num) => { 
	 const measurements = ["tbsp", "tablespoon", "tablespoons", "tsp", "teaspoon", "teaspoon", "oz", "ounce", "ounces", "pound", "pounds", "floz", "cup", "cups", "pint", "pints", "quart", "quarts", "gal", "gallon", "gallons", "lb", "lbs"]

	 const words = ingredients.split(" ") 
		 words.forEach((word, i) =>{
			 if(measurements.includes(word.toLowerCase())) {
				 words[i - 1] = parseFloat(words[i - 1]) * num 
			 }
			 const output = words.join(" ")
		}
	)
	// documnent not defined
	// const txt = document.getElementById('ingredients')
	// txt.innerText = output
} %>






<div class="container">
	<div class="row mt-4">
		<div class="col-6 show_image-container">
			<img src="<%= recipe.image_link %>">
		</div>
		<div class="col-6 show_details-container">
			<h1><%= recipe.title %></h1>
			<p><%= recipe.description %></p>
			<table class="table">
			  <tbody>
				<tr>
				  <th scope="row">Author</th>
				  <td><%= recipe.author %></td>
				</tr>
				<tr>
				  <th scope="row">Ingredients</th>
				  <td id="ingredients"><%= recipe.ingredients %></td>
				</tr>
				<tr>
				  <th scope="row">Date</th>
				  <td><%= recipe.date %></td>
				</tr>
				<tr>
				  <th scope="row">Series</th>
				  <td><%= recipe.series %></td>
				</tr>
				<tr>
				  <th scope="row">Issue #</th>
				  <td><%= recipe.issue %></td>
				</tr>
				<tr>
				  <th scope="row">Genre</th>
				  <td><%= recipe.genre %></td>
				</tr>
				<tr>
				  <th scope="row">Color?</th>
				  <td><%= recipe.color %></td>
				</tr>
				<tr>
				  <th scope="row">Portion?</th>
					<td><a class="btn btn-md btn-info w-20 my-1" onclick="<%= convertUnits(recipe.ingredients, 2) %>">Convert units x2
					  </a></td>
					<td><a class="btn btn-md btn-info w-20 my-1" onclick="<%= convertUnits(recipe.ingredients, 3) %>">Convert units x3
					  </a></td>
			  		<td><a class="btn btn-md btn-info w-20 my-1" onclick="<%= convertUnits(recipe.ingredients, 5) %>">Convert units x5
					  </a></td>
				</tr>
			  </tbody>
			</table>
			<% if (user && user.username === recipe.owner.username) { %>
				<a href="/recipes/<%= recipe.id %>/edit">
					<button class="btn btn-outline-info btn-lg btn-block mb-2">Edit</button>
				</a>
				<form action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST">
					<button type="submit" class="btn btn-outline-danger btn-lg btn-block">Delete</button>
				</form>
			<% } %>
		</div>
	</div>
	<div class="row">
		<a href="/recipes/<%= recipe._id %>/comments/new" class="col-3">
			<button class="btn-success btn-lg mt-3 mb-4">Add Comment</button>
		</a>
		<div>
			<button id="upvote_btn" class="btn btn-outline-success btn-lg -mt-3">+</button>
			<span id="score" class="mx-2">10</span>
			<button id="downvote_btn" class="btn btn-outline-danger btn-lg -mt-3">-</button>
		</div>
	</div>
	
	<% comments.forEach((comment) => { %>
		<div class="row show_comment-container py-2 border">
			<div class="col-2 border-right my-auto">
				<%= comment.user.username %>
			</div>
			<div class="col-2 border-right my-auto d-flex flex-wrap justify-content-center">
				<% if (user && user.username === comment.user.username) { %>
				<a class="btn btn-sm btn-success w-75 p-0 my-1" href="/recipes/<%= recipe._id %>/comments/<%= comment._id %>/edit">Edit</a>
				<form class="w-75 my-1" action="/recipes/<%= recipe._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
					<button class="btn btn-sm btn-danger w-100 p-0">Delete</button>
				</form>
				<% } %>
			</div>
			<div class="col-8 my-auto">
				<%= comment.text %>
			</div>
		</div>
	<% }) %>
	<div class="py-5"></div>
</div>



<%- include ("partials/footer") %>